<!-- Template: http://getbootstrap.com/examples/cover/ -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="This is a starter project for a chatbot concierge application built on AWS.">
    <meta name="author" content="Andrei Papancea">

    <title>Photo Album</title>

    <!-- Bootstrap core CSS -->
    <link href="./assets/css/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="./assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="./assets/css/photoalmbum.css" rel="stylesheet">

    <!--<link href="./assets/css/cover.css" rel="stylesheet">-->
    <!--<link href="./assets/css/main.css" rel="stylesheet">
    <link href="./assets/css/chat.css" rel="stylesheet">-->
    

    <!-- api gateway generated sdk -->
    <script src="./assets/js/sdk/lib/axios/dist/axios.standalone.js"></script>
    <script src="./assets/js/sdk/lib/CryptoJS/rollups/hmac-sha256.js"></script>
    <script src="./assets/js/sdk/lib/CryptoJS/rollups/sha256.js"></script>
    <script src="./assets/js/sdk/lib/CryptoJS/components/hmac.js"></script>
    <script src="./assets/js/sdk/lib/CryptoJS/components/enc-base64.js"></script>
    <script src="./assets/js/sdk/lib/url-template/url-template.js"></script>
    <script src="./assets/js/sdk/lib/apiGatewayCore/sigV4Client.js"></script>
    <script src="./assets/js/sdk/lib/apiGatewayCore/apiGatewayClient.js"></script>
    <script src="./assets/js/sdk/lib/apiGatewayCore/simpleHttpClient.js"></script>
    <script src="./assets/js/sdk/lib/apiGatewayCore/utils.js"></script>

    <script src="./assets/js/sdk/apigClient.js"></script>

    <script src="./assets/js/aws-sdk.min.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    <div class="container py-5">
      <!-- For demo purpose -->
      <div class="row mb-5">
        <div class="col-lg-8 text-white py-4 text-center mx-auto">
          <h1 class="display-4" style = "color: whitesmoke;">Photo Album</h1>
          <p class="lead mb-0" style = "color: whitesmoke;"> Option to search and upload images.</p>
        </div>
      </div>
      <!-- End -->
    
    
    
     
    
      <div class="p-5 bg-white rounded shadow mb-5">
        <!-- Lined tabs-->
        <ul id="myTab2" role="tablist" class="nav nav-tabs nav-pills with-arrow lined flex-column flex-sm-row text-center">
          <li class="nav-item flex-sm-fill">
            <a id="home2-tab" style = "color: whitesmoke;"data-toggle="tab" href="#home2" role="tab" aria-controls="home2" aria-selected="true" class="nav-link text-uppercase font-weight-bold mr-sm-3 rounded-0 active">Search</a>
          </li>
          <li class="nav-item flex-sm-fill">
            <a id="profile2-tab" style = "color: whitesmoke;" data-toggle="tab" href="#profile2" role="tab" aria-controls="profile2" aria-selected="false" class="nav-link text-uppercase font-weight-bold mr-sm-3 rounded-0">Upload</a>
          </li>
      
        </ul>
        <div id="myTab2Content" class="tab-content">
          <div id="home2" role="tabpanel" aria-labelledby="home-tab" class="tab-pane fade px-4 py-5 show active">
            <div class="site-wrapper white">

              <div class="site-wrapper-inner">
        
                <div class="cover-container">
        
                  <div class="masthead clearfix">
                    <div class="inner">
                     <!-- <h3 class="masthead-brand">Photo Album</h3>-->
                    </div>
                  </div>
                  
                    <div class="chat">
                      <!--<div class="messages">
                        <div class="messages-content"></div>
                      </div>-->
                      <!--
                      <div class="message-box">
                        <textarea type="text" class="message-input" placeholder="Type message..."></textarea>
                        <button class="Search" onclick="myFunction()"> Search Button</textarea>
                      </div>
                      -->
                      <!--<div class="message-box">
                        
                      </div>-->
                      
                    </div>
                   <div class="app"> 
                      <h3>Add New Note</h3>
                   <div class="input-single">
                          <textarea id="note-textarea" class="message-input" placeholder="Create a new note by typing or using voice recognition." rows="6"></textarea>
                      </div>         
                      <button id="start-record-btn" title="Start Recording">Start Recognition</button>
                      <button id="pause-record-btn" title="Pause Recording">Pause Recognition</button>
                      <button id="save-note-btn" class="Search" onclick="myFunction()" title="Save Note">Search</button>   
                      <p id="recording-instructions">Press the <strong>Start Recognition</strong> button and allow access.</p>
                  </div>
                    <div id = 'images_id'>
        
                    </div>  
        
        
                </div>
                
        
              </div>
        
            </div>
          </div>
          
          <div id="profile2" role="tabpanel" aria-labelledby="profile-tab" class="tab-pane fade px-4 py-5">
           <!-- <div>
              <h1>Welcome to our speech to text tool</h1>
              <h4 id="status">Press the button below, and start speaking</h4>
              <button onclick="startRecognition()">Speech to text</button>
              <div id="result" class="hide"></div>
            </div>-->
            
            
            <textarea class="associatedLabels" id="associatedLabels" placeholder="Enter custom labels"></textarea>
            <form class = 'form-data'enctype="multipart/form-data"  id = 'form-upload' accept="image/*">
              <input type="file" id="myFile" name="files[]">
              <input type="button" onclick="handleFileSubmit()" value="Submit file">
            </form>
            <!--<form enctype="multipart/form-data">
              <input id="upload" type=file   accept="image/*" name="files[]" size=30>
              </form>
              
              
              <textarea class="associatedLabels" id="associatedLabels" placeholder="Enter custom labels"></textarea>-->
              
              <script>

                function ArrayBufferToBinary(buffer) {
                  // Convert an array buffer to a string bit-representation: 0 1 1 0 0 0...
                  var dataView = new DataView(buffer);
                  var response = "", offset = (8/8); 
                  for(var i = 0; i < dataView.byteLength; i += offset) {
                      response += dataView.getInt8(i).toString(2); 
                  }
                  return response;
                }

                function getBase64(file) {
                    labels = retrieveCustomLabels()
                    var reader = new FileReader();
                    reader.readAsDataURL(file);


                  //   reader.onload = function(event) {
                  //     var data = event.target.result;
                  //     data_new = (ArrayBufferToBinary(data));
                  //     console.log(data_new)
                  //     callUploadPutFetch(f['name'],data_new)
                  // };

                    reader.onload = function () {
                     var data=(reader.result).split(',')[1];
                     var binaryBlob = atob(data);
                     console.log('Encoded Binary File String:', binaryBlob);
                     //callUploadPutFetch(file['name'], binaryBlob)
                     callUploadPutFetch(file['name'], file,labels)
                    };
                    reader.onerror = function (error) {
                      console.log('Error: ', error);
                    };
                  }
              
                  function retrieveCustomLabels(){
                    labels = $('.associatedLabels').val();
                    labels_array = labels.split(',')
                    return labels_array
                    
                  }
              

              function handleFileSubmit() {
                file = document.getElementById('myFile').files[0]
                getBase64(file)



              }


              function handleFileSelect(evt) {
                  let files = evt.target.files; // FileList object
              
                  // use the 1st file from the list
                  let f = files[0];
                  console.log(f)
                  getBase64(f)
                  // let reader = new FileReader();
              
                  // // // Closure to capture the file information.
                  // reader.onload = function(event) {
                  //     var data = event.target.result;
                  //     data_new = (ArrayBufferToBinary(data));
                  //     console.log(data_new)
                  //     callUploadPutFetch(f['name'],data_new)
                  //};
                  // // data_new = reader.readAsArrayBuffer(f); 
                  // // console.log(data_new)
                  // reader.onloadend = function() {
                  //   console.log('Encoded Base 64 File String:', reader.result);
                    
                  //   /******************* for Binary ***********************/
                  //   var data=(reader.result).split(',')[1];
                  //   var binaryBlob = atob(data);
                  //   console.log('Encoded Binary File String:', binaryBlob);
                  //   callUploadPut(f['name'],binaryBlob)

                  // }
                  // reader.readAsDataURL(f);

                                

                }


                function callUploadPutFetch(message,data_img,associatedLabels){

                  
                  url = 'https://uet3ogk4d2.execute-api.us-east-1.amazonaws.com/stage_v1/upload/photos-assignment-b2/'+message
                  fetch(url, {
                    //mode:{mode:"no-cors"},
                      method: 'PUT', // or 'PUT'
                      headers: {
                        'Content-Type': 'application/octet-stream',
                        
                          'x-amz-meta-customLabels': associatedLabels
                        

                      },
                      body: data_img
                    })
                    .then(response => {console.log(response)})
                    .then(data => {
                      console.log('Success:', data);
                    })
                    .catch((error) => {
                      console.error('Error:', error);
                    });

                }

                function callUploadPut(message,data){
                  console.log(message)
                  content_type = 'application/octet-stream'
                  real_content_type = 'application/octet-stream'
                  bucket = 'photos-assignment-b2'
                  var additionalparams = {
                      headers: {
                          'Content-Type': content_type,
                          'realcontenttype': real_content_type,
                      },
                      queryParams: {}
                  }
                  var params = {
                      'object':message,
                      'Content-Type': content_type,
                      'realcontenttype': real_content_type,
                      'bucket':bucket,
                      headers: {
                          'Content-Type': content_type,
                          'realcontenttype': real_content_type,
                      },
                  };
                  console.log(additionalparams);
                  return sdk.uploadBucketObjectPut(params,{data},additionalparams);
                }
              
                //document.getElementById('upload').addEventListener('change', handleFileSelect, false);
                document.getElementById('upload').addEventListener('change', handleFileSelect, false);
                //New Line added here
              </script>
            
           </div>
      
        </div>
        <!-- End lined tabs -->
      </div>
    
    </div>


    <script>

      var sdk = apigClientFactory.newClient({});

    </script>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- <script>window.jQuery || document.write('<script src="./assets/js/vendor/jquery.min.js"><\/script>')</script> -->
    <script src="./assets/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="./assets/js/ie10-viewport-bug-workaround.js"></script>
    <!-- custom scroll bar -->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.3/jquery.mCustomScrollbar.concat.min.js'></script>
    <!-- chat js -->
    <script src="./assets/js/textbar.js"></script>
    <script src="./assets/js/speechrec.js"></script>
    <script src="./assets/js/chat.js"></script>
    
    
  </body>
</html>
